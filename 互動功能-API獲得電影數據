const API_KEY = "ä½ çš„APIé‡‘é‘°";  // é€™è£¡æ›æˆä½ ç”³è«‹çš„ TMDb API Key
const BASE_URL = "https://api.themoviedb.org/3";
const IMAGE_URL = "https://image.tmdb.org/t/p/w500";

// ğŸ”¹ 1. ç²å–ç†±é–€é›»å½±ï¼ˆé¦–é ï¼‰
async function fetchPopularMovies() {
    try {
        const response = await fetch(`${BASE_URL}/movie/popular?api_key=${API_KEY}&language=zh-TW&page=1`);
        const data = await response.json();
        displayMovies(data.results);
    } catch (error) {
        console.error("ç²å–é›»å½±è³‡æ–™å¤±æ•—:", error);
    }
}

// ğŸ”¹ 2. é¡¯ç¤ºé›»å½±åˆ—è¡¨
function displayMovies(movies) {
    const container = document.getElementById("movie-container");
    container.innerHTML = "";

    movies.forEach(movie => {
        const movieCard = document.createElement("div");
        movieCard.classList.add("movie-card");
        movieCard.innerHTML = `
            <img src="${IMAGE_URL + movie.poster_path}" alt="${movie.title}">
            <h3>${movie.title}</h3>
            <p>è©•åˆ†ï¼š${movie.vote_average}/10</p>
        `;
        movieCard.onclick = () => location.href = `movie.html?id=${movie.id}`;
        container.appendChild(movieCard);
    });
}

// ğŸ”¹ 3. ç²å–é›»å½±è©³ç´°è³‡è¨Šï¼ˆmovie.htmlï¼‰
async function loadMovieDetails() {
    const urlParams = new URLSearchParams(window.location.search);
    const movieId = urlParams.get("id");
    if (!movieId) return;

    try {
        const response = await fetch(`${BASE_URL}/movie/${movieId}?api_key=${API_KEY}&language=zh-TW`);
        const movie = await response.json();

        document.getElementById("movie-title").innerText = movie.title;
        document.getElementById("movie-year").innerText = movie.release_date;
        document.getElementById("movie-genre").innerText = movie.genres.map(g => g.name).join(", ");
        document.getElementById("movie-rating").innerText = movie.vote_average + "/10";
        document.getElementById("movie-description").innerText = movie.overview;
        document.getElementById("movie-poster").src = IMAGE_URL + movie.poster_path;
    } catch (error) {
        console.error("ç„¡æ³•ç²å–é›»å½±è©³æƒ…:", error);
    }
}

// ğŸ”¹ 4. ç•¶é¦–é è¼‰å…¥æ™‚ï¼Œé¡¯ç¤ºç†±é–€é›»å½±
if (document.getElementById("movie-container")) {
    document.addEventListener("DOMContentLoaded", fetchPopularMovies);
}

// ğŸ”¹ 5. ç•¶é›»å½±è©³æƒ…é è¼‰å…¥æ™‚ï¼Œé¡¯ç¤ºé›»å½±è³‡è¨Š
if (document.getElementById("movie-title")) {
    document.addEventListener("DOMContentLoaded", loadMovieDetails);
}
const movies = [
  {
    title: 'æ˜Ÿéš›æ•ˆæ‡‰',
    category: 'ç§‘å¹»',
    rating: 5,
    reason: 'æ ¹æ“šä½ çš„å–œå¥½ã€Œæ™‚é–“æ—…è¡Œã€èˆ‡ã€Œå¤ªç©ºæ¢ç´¢ã€æ¨è–¦ã€‚',
    description: 'ä¸€åå¤ªç©ºäººç‚ºæ‹¯æ•‘äººé¡ç©¿è¶ŠèŸ²æ´å°‹æ‰¾æ–°å®¶åœ’ã€‚',
    director: 'Christopher Nolan',
    year: 2014
  },
  {
    title: 'ä½ çš„åå­—',
    category: 'æ„›æƒ…',
    rating: 4,
    reason: 'ä½ å–œæ­¡é’æ˜¥æ„›æƒ…å‹•ç•«ï¼Œé€™éƒ¨çµ•å°ä¸èƒ½éŒ¯éã€‚',
    description: 'ä¸€å°ç”·å¥³åœ¨å¤¢ä¸­äº’æ›èº«é«”ï¼Œå±•é–‹è·¨è¶Šæ™‚ç©ºçš„å¥‡å¦™ç·£åˆ†ã€‚',
    director: 'æ–°æµ·èª ',
    year: 2016
  },
  {
    title: 'å¯„ç”Ÿä¸Šæµ',
    category: 'åŠ‡æƒ…',
    rating: 5,
    reason: 'å› ç‚ºä½ å–œæ­¡æ­ç¤ºç¤¾æœƒè­°é¡Œçš„åŠ‡æƒ…ç‰‡ã€‚',
    description: 'è²§å¯Œéšç´šçš„å°ç«‹èˆ‡è¡çªï¼Œåœ¨ä¸€å ´é¨™å±€ä¸­çˆ†ç™¼ã€‚',
    director: 'å¥‰ä¿Šæ˜Š',
    year: 2019
  },
  {
    title: 'å…¨é¢å•Ÿå‹•',
    category: 'ç§‘å¹»',
    rating: 4,
    reason: 'ä½ å–œæ­¡å¤¢å¢ƒèˆ‡å¿ƒç†å±¤é¢çš„æ·±åº¦é›»å½±ã€‚',
    description: 'æ½›å…¥ä»–äººå¤¢å¢ƒæ¤å…¥æ€æƒ³çš„é«˜æ™ºå•†å‹•ä½œç‰‡ã€‚',
    director: 'Christopher Nolan',
    year: 2010
  }
];

let currentCategory = 'å…¨éƒ¨';

function displayMovies() {
  const list = document.getElementById('movieList');
  list.innerHTML = '';

  const search = document.getElementById('searchInput').value;

  const filtered = movies.filter(movie =>
    (currentCategory === 'å…¨éƒ¨' || movie.category === currentCategory) &&
    movie.title.includes(search)
  );

  filtered.forEach(movie => {
    const movieDiv = document.createElement('div');
    movieDiv.className = 'movie';

    const stars = 'â˜…'.repeat(movie.rating) + 'â˜†'.repeat(5 - movie.rating);

    movieDiv.innerHTML = `
      <h2>${movie.title}</h2>
      <div class="stars">${stars}</div>
      <div class="recommendation">${movie.reason}</div>
    `;

    movieDiv.onclick = () => showDetails(movie);
    list.appendChild(movieDiv);
  });
}

function searchMovies() {
  displayMovies();
}

function filterCategory(category) {
  currentCategory = category;
  displayMovies();
}

function showDetails(movie) {
  const modal = document.getElementById('movieModal');
  const content = document.getElementById('modalContent');

  content.innerHTML = `
    <span class="close-btn" onclick="closeModal()">Ã—</span>
    <h3>${movie.title}</h3>
    <p><strong>å°æ¼”ï¼š</strong> ${movie.director}</p>
    <p><strong>å¹´ä»½ï¼š</strong> ${movie.year}</p>
    <p><strong>ç°¡ä»‹ï¼š</strong> ${movie.description}</p>
    <p><strong>æ¨è–¦ç†ç”±ï¼š</strong> ${movie.reason}</p>
    <button class="favorite-btn" onclick="addToFavorites('${movie.title}')">æ”¶è—</button>
  `;
  modal.style.display = 'flex';
}

function closeModal() {
  document.getElementById('movieModal').style.display = 'none';
}

function addToFavorites(title) {
  alert(`å·²æ”¶è—ã€Œ${title}ã€ï¼`);
  closeModal();
}

window.onload = displayMovies;
